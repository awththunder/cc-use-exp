---
description: 新功能全流程（需求审问 → 设计 → 实现）
---

一站式完成新功能开发，支持中断恢复。

## 输入

「$ARGUMENTS」— 功能描述，或 `--resume` 恢复未完成任务

## 任务文件

位置：`.claude/tasks/{功能名}-{日期}.md`
作用：持久化任务状态，支持中断恢复

## 流程

### 第 0 步：检查恢复

1. 检查 `.claude/tasks/` 目录（不含 archived 子目录）是否存在 .md 文件
2. 如果有未完成任务：
   - 列出任务文件名和状态
   - 询问：「检测到未完成任务 [任务名]，是否继续？(Y/N)」
   - Y → 读取任务文件，从未完成步骤继续
   - N → 将旧任务移动到 archived，然后开始新任务
3. 如果没有未完成任务 → 进入第 1 步

### 第 1 步：需求审问

针对「$ARGUMENTS」，快速提出 3-5 个关键问题：
- 边界条件
- 异常处理
- 依赖关系

等待用户回答后继续。

### 第 2 步：技术设计 + 创建任务文件

基于回答，输出：
- 涉及文件（3-5 个）
- 数据结构（如有）
- 关键步骤（3-5 步）

**用户确认后**，创建任务文件 `.claude/tasks/{功能名}-{日期}.md`：

```markdown
# 任务：{功能名}
状态：进行中
创建：{时间}
更新：{时间}

## 需求摘要
- {一句话描述}

## 关键决策
- {决策1}
- {决策2}

## 实现计划
- [ ] 1. {步骤1}
- [ ] 2. {步骤2}
- [ ] 3. {步骤3}

## 已修改文件
（实现过程中更新）
```

### 第 3 步：实现 + 同步更新

按步骤实现，**每完成一个步骤**：

1. 更新任务文件：
   - 将已完成步骤标记为 `[x]`
   - 将当前步骤标记为 `[~]`（进行中）
   - 在「已修改文件」添加本步骤修改的文件
   - 更新「更新时间」
2. 报告进度
3. 继续下一步

### 第 4 步：自审 + 归档

1. 执行 `/quick-review`
2. 更新任务文件状态为「已完成」
3. 将任务文件移动到 `.claude/tasks/archived/`

## 中断恢复说明

如果任务中断（网络断开、上下文超限、手动停止）：
1. 下次执行 `/new-feature` 或 `/new-feature --resume` 会自动检测
2. 读取任务文件恢复上下文
3. 从未完成的步骤继续执行
