# GEMINI.md - 智能工作规则

版本：v1.0
作者：wwj
更新：2026-01-05

---

## 核心原则（不可违反）

| 原则 | 说明 |
|------|------|
| 质量第一 | 代码质量和系统安全不可妥协 |
| 中文交流 | 统一使用中文回复、注释和文档 |
| 完整实现 | 禁止 MVP/占位/TODO，必须完整可运行 |

---

## 质量标准

### 工程原则

- **架构设计**：SOLID、DRY、关注点分离
- **代码质量**：清晰命名、合理抽象、必要中文注释
- **测试要求**：可测试设计，单元测试覆盖

### 性能意识

- 考虑时间复杂度和空间复杂度
- 优化内存使用和 IO 操作
- 处理异常情况和边界条件

---

## 工具指南

### 工具选择优先级

| 需求 | 首选 | 降级方案 |
|------|------|---------|
| 本地文件/命令 | Desktop Commander | 内置工具 |
| 技术文档查询 | Context7 | DuckDuckGo → Fetch |
| 复杂任务规划 | Sequential-Thinking | 手动分解 |
| 网页搜索 | DuckDuckGo | WebSearch |
| GitHub 文档 | DeepWiki | 直接访问 |

### MCP 调用规则

**核心策略**：
- 审慎单选：每轮最多 1 个 MCP 服务
- 序贯调用：多服务需求时必须串行
- 最小范围：精确限定查询参数

**Context7 使用流程**：
1. `resolve-library-id` → 确定库标识
2. `get-library-docs` → 获取文档（tokens ≤ 5000）

**Desktop Commander 使用场景**：
- 代码检索、架构走查
- 跨文件引用查找
- 批量重构、脚本执行

**错误处理**：
- 429 限流：退避 20s，降低参数范围
- 5xx/超时：单次重试，退避 2s
- 无结果：缩小范围或请求澄清

---

## 工作流程

### 任务类型适配

| 类型 | 流程调整 |
|------|---------|
| 紧急修复 | 精简流程，保留核心质量检查 |
| 新功能开发 | 完整流程，强调设计和测试 |
| 重构优化 | 重点关注架构和性能标准 |

### 关键检查点

**任务开始**：
- [ ] 根据任务特征选择适配策略
- [ ] 确认工具可用性和降级方案

**编码前**：
- [ ] 使用工具理解现有代码
- [ ] 制定实施计划和质量标准

**完成后**：
- [ ] 验证功能正确性和代码质量
- [ ] 更新相关测试和文档

---

## 行为准则

| 准则 | 说明 |
|------|------|
| 查询胜过猜测 | 不确定时先查证 |
| 复用胜过创造 | 优先使用现有代码 |
| 测试胜过跳过 | 确保代码可验证 |
| 诚实胜过假装 | 不懂就说不懂 |

---

## 工具调用简报格式

每次 MCP 调用后，在回复末尾附加：

```
【MCP 调用简报】
- 服务：<服务名>
- 触发：<具体原因>
- 参数：<关键参数摘要>
- 结果：<命中数/主要来源>
- 状态：<成功|重试|降级>
```

---

## 前端修改安全约束

修改 Vue/React 文件时，必须遵守以下规则，防止破坏已有功能。

### 绝对禁止修改

| 类型 | 说明 | 示例 |
|------|------|------|
| 数据绑定 | v-model / v-bind 的字段名 | `v-model="form.username"` |
| Props | props 定义和传递的属性名 | `:user-id="userId"` |
| 事件 | emit 事件名和 @ 绑定 | `@click="handleSubmit"` |
| 响应式变量 | ref / reactive 变量名 | `const loading = ref(false)` |
| API 调用 | 接口路径、参数、响应处理 | `api.getUser(id)` |
| 类型定义 | TypeScript interface/type | `interface User { ... }` |
| 函数名 | 已有的方法和函数名 | `function handleSubmit()` |

### 允许修改

| 类型 | 说明 | 示例 |
|------|------|------|
| 布局结构 | div / el-row / el-col 层级 | 减少嵌套层级 |
| 布局组件 | Element Plus 布局相关属性 | `span` / `gutter` / `justify` |
| CSS 样式 | style 中的样式代码 | `padding` / `margin` / `flex` |
| 样式类名 | 纯样式用途的 class | `class="container"` |
| 包裹元素 | 不影响逻辑的外层容器 | 添加/移除布局用的 div |

### 修改前检查

修改任何前端文件前，先识别：
1. 哪些是**数据绑定**（v-model、:prop）→ 不动
2. 哪些是**事件处理**（@click、@change）→ 不动
3. 哪些是**布局结构**（div、el-row）→ 可优化

---

## 代码风格

### 注释规范

- ❌ 禁止行尾注释（如 `int x = 1; // 这是注释`）
- ✅ 注释应独占一行，放在代码上方

```javascript
// ❌ 错误
const maxRetry = 3; // 最大重试次数

// ✅ 正确
// 最大重试次数
const maxRetry = 3;
```

### 语言要求

- 所有回答使用简体中文
- 代码注释使用简体中文
- 变量名、函数名保持英文

---

## 禁止行为

- ❌ 修改测试来适配错误代码
- ❌ 删除或注释掉失败的测试
- ❌ 提交调试残留（print/console.log/debugger）
- ❌ 用"注释掉旧实现"代替删除
- ❌ 主动创建文档文件（除非明确要求）
- ❌ 添加 AI 生成声明或元数据
- ❌ 使用行尾注释

---

## 技术栈偏好

| 场景 | 首选 | 备选 |
|------|------|------|
| Go 后端 | Gin + GORM | Echo, Fiber |
| Java 后端 | Spring Boot | - |
| 前端 | Vue 3 + TS + Vite + Element Plus | React + Ant Design |
| 数据库 | SQLite (轻量) / MySQL (生产) | PostgreSQL |
